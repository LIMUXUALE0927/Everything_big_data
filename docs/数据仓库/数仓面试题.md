# 数仓面试题

## 数仓理论

### 数据库 VS 数据仓库

**数据库**是面向事务的处理系统 **OLTP**，主要数据操作是随机读写，主要采用**满足 3NF 的实体关系模型**存储数据，从而**在事务处理中解决数据的冗余和一致性问题**。

**数据仓库**是面向主题的、集成的、非易失的且随时间变化的**数据集合**。数据仓库一般**针对某些主题的历史数据进行分析**、支持管理决策，又被称为**联机分析处理 OLAP**。

OLAP 系统面向的主要数据操作是批量读写，事务处理中的一致性不是 OLAP 所主要关注的，其主要**关注数据的整合，以及在一次性的复杂大数据查询和处理中的性能**，因此它需要采用一些不同的数据建模方法。

!!! note "区别"

    - 数据库是面向事务的设计，数据仓库是面向主题设计的。
    - 数据库一般存储业务数据，数据仓库存储的一般是历史数据。
    - 数据库设计是尽量避免冗余，常采用符合范式规范来设计。数据仓库设计关注数据整合、分析、处理性能，有意引入冗余，采用反范式设计。
    - 数据库主要操作是随机读写，数据仓库是为分析数据而设计，主要操作是批量读写。

---

### 数据仓库的四个特点

- **面向主题的**：数据仓库的数据是按照主题进行组织的，每个主题都能反应具体的业务需求，以电商数仓为例，常见主题有用户、商品、商户、交易、营销等。
- **集成的**：数据仓库中的数据从多个数据源中汇集，经过清洗、转换、统一而来的。
- **非易失的**：数据仓库中的数据以大量的查询为主，修改和删除的操作很少，只需要定期加载、更新即可。
- **随时间变化的**：数据仓库中的数据是反应历史变化的，包含从过去某一时间点至今的数据。

---

### 为什么需要建设数据仓库

- **维护历史数据**，可以基于历史数据进行分析，为企业提供决策支持。
- **减轻业务数据库的存储和计算压力**。
- 将多个数据源的数据进行整合，能够提供一个**统一的数据视图**，方便分析。
- 能够将多个数据源的数据进行**清洗、转换、统一**，**提高数据质量**。
- 基于分布式系统，能够提供**海量数据的存储能力以及高性能的计算能力**。
- 利用分层架构，能够**快速查询大量经整合的数据**，并减少重复的开发过程。

---

### 常见的数据仓库架构

**Inmon 架构：**

Inmon 架构的思想在于**自上而下地构建数据模型**。Bill Inmon 的方法强调更加集中、全面和结构化的数据仓库环境。 它**提倡标准化的数据模型**，其中数据被组织到单独的表中，以**消除冗余并保持数据完整性**。**其核心思想在于数仓分层**。

它使用“数据仓库总线”的概念来创建标准化、可重用的组件，并强调数据集成、转换和治理，以确保数据的准确性和一致性。换言之就是，尽量将某一主题域的所有数据都考虑到数据建模中。这样设计的数据模型的覆盖面会更广，但是数据模型的设计会更困难。

![](https://raw.githubusercontent.com/MXJULY/image/main/img/202312281718960.png)

**Kimball 架构：**

Kimball 架构的思想在于**自下而上地构建数据模型**。以具体业务需求为出发点，设计数据模型，**其核心思想在于维度建模**。（即根据业务需求找到关注的数据指标，基于关注的数据指标设计数据模型，这样设计的数据模型会更加的独立，但可能会导致数据模型过多发展）

Ralph Kimball 以其维度建模方法而闻名，该方法**专注于以针对最终用户查询和报告优化的方式提供数据**。 Kimball 方法侧重于使用星型模式结构创建数据仓库，其中中央事实表保存定量度量，维度表描述相关属性。 它是一种自上而下、迭代且敏捷的方法，强调通过构建特定于主题的数据集市来满足特定用户报告需求来快速交付业务价值。

![](https://raw.githubusercontent.com/MXJULY/image/main/img/202312281727600.png)

!!! note

    目前企业的数据仓库设计一般都是综合了两者的实现，整体上采用分层架构，具体的模型设计上采用维度建模。

**数据集市架构：**

数据集市是**按主题域组织的数据集合**，用于支持部门级的决策。

![](https://raw.githubusercontent.com/MXJULY/image/main/img/202312281729247.png)

**混合型数据仓库架构：**

所谓的混合型结构，指的是在一个数据仓库环境中，联合使用 Inmon 和 Kimball 两种架构。

这种架构将 Inmon 方法中的数据集市部分替换成了一个多维数据仓库，而数据集市则是多维数据仓库上的逻辑视图。

使用这种架构的好处是，既可以利用规范化设计消除数据冗余，保证数据的粒度足够细，又可以利用多维结构更灵活地在企业级实现报表和分析。

![](https://raw.githubusercontent.com/MXJULY/image/main/img/202312281730852.png)

---

### Kimball 数据仓库架构包括哪些模块

- **操作型系统/数据源**：包括各种数据源，如业务数据库、日志文件、外部数据等。
- **数据过渡区**：包括数据清洗、数据转换、数据集成等。
- **数据仓库**：维度建模，以星型模型或是雪花模型等方式构建维度数据仓库。
- **用户接口**：包括即席查询、报表、可视化、数据挖掘等。

---

### 对比 Inmon 和 Kimball 架构

**Inmon 架构：**

Inmon 架构的思想在于**自上而下地构建数据模型**，从数据源到数据仓库再到数据集市。**强调标准化的数据模型**，使用范式建模以**消除冗余并保持数据完整性**。**其核心思想在于数仓分层**。

其中的数据建模分为三个层次：高层模型、中间层模型、底层模型。

- ERD（实体关系图）是最顶层的概念模型，是实体关系的高度抽象，主要用于确定各个实体（或主题）及其之间的关系
- 中间层是数据集成（DIS），用于对主要数据分组，设置数据的链接，确定主键、属性和关系
- 底层是物理模型，用于设计关系表，在这一层上，确定数据的粒度、对数据进行分区、定义引用、创建索引等

**Kimball 架构：**

Kimball 架构的思想在于**自下而上地构建数据模型**，从数据源到数据集市再到数据仓库。根据业务需求找到关注的数据指标，再基于关注的数据指标设计数据模型。**其核心思想在于维度建模**，以星型模型或是雪花模型等方式构建维度数据仓库。

| Inmon 架构                                                                               | Kimball 架构                                                                         |
| :--------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------- |
| Inmon 架构由于采用了范式建模，所以数据模型的设计更加的规范，但是数据模型的设计会更困难。 | Kimball 架构由于采用了维度建模，所以数据模型的设计更加的灵活，但是维护的成本会更高。 |

---

### 介绍一下常见的数据模型

**关系数据模型/范式模型：**

关系数据模型是一种**二维表格模型**，它将数据组织成**行和列**的形式，每一行称为一个记录，每一列称为一个字段，每个字段只有一个值，每个记录都是唯一的。

关系数据模型的设计遵循一定的规范，即**范式**，范式分为六种，分别是第一范式（1NF）、第二范式（2NF）、第三范式（3NF）、巴斯-科德范式（BCNF）、第四范式（4NF）、第五范式（5NF）。

**维度数据模型：**

按照事实表和维度表进行构建数仓和数据集市，以星型模型和雪花模型为主。切换不同维度的查询时非常的方便，有良好的扩展性能。

**Data Vault 模型：**

中心辐射式，中心表记录主键，链接表记录业务关系，附属表记录业务描述。

---

### 介绍一下三范式

!!! note "1NF"

    **确保表中的每列是原子、不可再分的。**

!!! note "2NF"

    在满足 1NF 的情况下，**不能存在部分依赖。**即非主键字段必须**完全依赖**于主键，而不能依赖于主键的一部分。

考虑一个订单明细表：`OrderDetail(OrderID，ProductID，UnitPrice，Discount，Quantity，ProductName)`。

因为我们知道在一个订单中可以订购多种产品，所以单单一个 OrderID 是不足以成为主键的，主键应该是 `(OrderID，ProductID)`。显而易见 `Discount` 和 `Quantity` 完全依赖于主键 `(OrderID，ProductID)`，而 `UnitPrice` 和 `ProductName` 只依赖于 `ProductID`。所以 OrderDetail 表不符合 2NF。不符合 2NF 的设计容易产生冗余数据。

可以把 OrderDetail 表拆分为 `OrderDetail(OrderID，ProductID，Discount，Quantity)` 和 `Product(ProductID，UnitPrice，ProductName)` 来消除原订单表中 `UnitPrice` 和 `ProductName` 多次重复的情况。

!!! note "3NF"

    在满足 2NF 的情况下，**不能存在传递依赖。** 3NF 是对字段冗余性的约束，要求任何字段不能由其他字段派生出来，它要求字段没有冗余，即不存在传递依赖。

考虑一个订单表 `Order(OrderID，OrderDate，CustomerID，CustomerName，CustomerAddr，CustomerCity)` 主键是 `(OrderID)`。

其中 `OrderDate, CustomerID, CustomerName, CustomerAddr, CustomerCity` 等非主键列都完全依赖于主键 `(OrderID)`，所以符合 2NF。不过问题是 `CustomerName, CustomerAddr, CustomerCity` 直接依赖的是 `CustomerID`（非主键列），而不是直接依赖于主键，它是通过传递才依赖于主键，所以不符合 3NF。

通过拆分 Order 为 `Order(OrderID，OrderDate，CustomerID)` 和 `Customer(CustomerID，CustomerName，CustomerAddr，CustomerCity)` 从而达到 3NF。

**第二范式（2NF）和第三范式（3NF）的概念很容易混淆，区分它们的关键点在于，2NF：非主键列是否完全依赖于主键，还是依赖于主键的一部分；3NF：非主键列是直接依赖于主键，还是直接依赖于非主键列。**

!!! note "反范式化"

    降低范式就是增加字段，允许冗余，达到以空间换时间的目的。

没有冗余的数据库设计可以做到。但是，没有冗余的数据库未必是最好的数据库，有时为了提高运行效率，就必须降低范式标准，适当保留冗余数据。

如订单表，“金额”这个字段的存在，表明该表的设计不满足第三范式，因为“金额”可以由“单价”乘以“数量”得到，说明“金额”是冗余字段。但是，增加“金额”这个冗余字段，可以提高查询统计的速度，这就是以空间换时间的作法。

---

### 列举一下你使用过的反范式化设计，并说明理由

- 逆 1NF：在商品表的商品标签中保留 kv 结构
- 逆 2NF：订单明细表，主键为 (orderId, productId)，我们知道 (unitPrice, productName)这些字段只依赖于 productId，即主键的一部分，因此如果放入订单明细表，不符合 2NF；如果我们冗余进表中，可以提高查询效率
- 逆 3NF：订单表中「金额」字段可以由「单价」\* 「数量」得到，因此违反 3NF，但是通过冗余「金额」字段，可以提高统计查询的效率

---

### 维度建模的基本流程

维度建模主要涉及 5 个主要的过程:

1. **收集需求**：通过与业务方沟通、查看报表等方式了解业务需求，理解所需的指标
2. **选择业务过程**：确定要进行分析的业务过程，业务过程定义了设计目标以及对粒度、维度、事实的定义
3. **声明粒度**：粒度用于确定事实表中的每一行所表示的业务含义。候选的维度和事实必须与定义的粒度一致。
4. **确认维度**：维度是分析事实所需要的环境/角度。例如在分析交易过程时，可以通过商品、买家、卖家、时间等维度来分析交易过程。
5. **确认事实**：事实是业务过程的度量，基本上都是以数据值表示。事实有可加性、半可加性和非可加性三种类型，需要将非可加性事实分解为可加的组件。

在建模期间，需要考虑业务需求以及协作建模阶段涉及的底层数据源。从上述维度建模步骤来看，重点在解决数据粒度、维度设计和事实表设计问题。

![](https://raw.githubusercontent.com/MXJULY/image/main/img/202401132006120.png)

例如：交易域中的**订单付款**业务过程，其粒度是每笔子订单，维度是买家、商品、卖家、订单时间等，事实是订单金额、订单数量等。

---

### 如何做维度设计

1. **选择或者新建一个维度**，通过之前总线矩阵的构建掌握了目前数仓架构中的维度。
2. **确定主维表**。此处主维表一般是 ODS 表，直接与业务系统同步。
3. **确定相关维表**。数仓是业务源系统的数据整合，不同业务系统或者同一业务系统中的表之间存在关联性。跟据对业务的梳理，我们可以确认哪些表和主维表存在关联关系，并选择其中的某些表用于生成维度属性。
4. **确定维度属性**。本步骤分为两阶段，第一阶段是从主维表中选择维度属性或生成新的维度属性；第二阶段是从相关维表中选择维度属性或生成新的维度属性。

以商品维度举例：

1. 选择维度：商品维度
2. 确定主维表：商品表
3. 确定相关维表：商品分类表、商品品牌表、SPU 表等
4. 确定维度属性：商品表中的商品 ID、商品名称、商品价格等；商品分类表中的商品分类 ID、商品分类名称等；商品品牌表中的商品品牌 ID、商品品牌名称等；SPU 表中的商品 SPU ID、商品 SPU 名称等。

---

### 介绍一下星型模型、雪花模型和星座模型

**星型模型：**

**星型模式由事实表和维度表组成，一个星型模式中可以有一个或多个事实表，每个事实表引用任意数量的维表。**

![](https://raw.githubusercontent.com/MXJULY/image/main/img/202312281918072.png)

星型模式是**反范式化(denormalized)**的，**优点**是设计和实现起来比较简单，查询性能也比较高（join 的数量较少）。但是，星型模式的**缺点**是数据存储空间较大；而且，由于是非规范化的，数据的更新操作会更困难。星型模式的另一个缺点是对于分析需求来说不够灵活。它更偏重于为特定目的建造数据视图，因此实际上很难进行全面的数据分析。

**雪花模型：**

雪花模型是星型模型的扩展，**雪花模型是在星型模型的基础上，将维度表进一步范式化(normalized)**，即将维度表中的某些字段单独成表，这些字段和维度表的主键构成主外键关系。

![](https://raw.githubusercontent.com/MXJULY/image/main/img/202312281919853.png)

雪花模型的特点是**维度表的规范化程度更高**，因此**减少了数据冗余、节省了存储空间**，但是不可避免地增加了表的数量，因此**查询性能会有所下降**。

**星型 VS 雪花模型**

| 属性           | 星型模型 | 雪花模型           |
| :------------- | :------- | :----------------- |
| 数据总量       | 多       | 少                 |
| 可读性         | 高       | 低                 |
| 表个数         | 少       | 多                 |
| 查询速度       | 高       | 低                 |
| 数据冗余       | 多       | 少                 |
| 对事实表的情况 | 增加宽度 | 字段比较少，冗余低 |
| 拓展性         | 差       | 好                 |

**星型模型因为数据的冗余所以很多统计查询不需要做外部的连接，因此一般情况下效率比雪花型模型要高**。星型结构不用考虑很多范式化的因素，设计与实现都比较简单。

雪花型模型由于去除了冗余，有些统计就需要通过表的联接才能产生，所以效率不一定有星型模型高。范式化也是一种比较复杂的过程，相应的数据库结构设计、数据的 ETL、以及后期的维护都要复杂一些。**因此在冗余可以接受的前提下，实际运用中星型模型使用更多，也更有效率**。

**星座模型：**

星座模型是星型模型和雪花模型的混合体，**星座模型是在星型模型的基础上，多个事实表共享维度表**。

![](https://raw.githubusercontent.com/MXJULY/image/main/img/202312281933541.png)

---

### 介绍一下几种事实表并说明应用场景

- **事务事实表**：记录事务层面的事实，记录最原子的数据，粒度通常为每个事务记录一条数据
- **周期快照事实表**：以周期性的时间间隔来记录事实，如库存日快照表，粒度是一个周期性的时间间隔内的事务记录一条数据
- **累计快照事实表**：记录不确定周期的数据，通常覆盖一个事务的生命周期，记录一些关键时间点，如订单累计快照事实表会记录付款日期、发货日期、收货日期等。

|            |       事务事实表       |          周期快照事实表          |            累计快照事实表            |
| ---------- | :--------------------: | :------------------------------: | :----------------------------------: |
| 时间       |     离散事务时间点     | 以有规律的、可预测的间隔产生快照 | 用于时间跨度不确定的不断变化的工作流 |
| 日期维度   |        事务日期        |             快照日期             |      相关业务过程涉及的多个日期      |
| 粒度       | 每行代表实体的一个事务 |   每行代表某时间周期的一个实体   |      每行代表一个实体的生命周期      |
| 事实       |        事务事实        |             累积事实             |    相关业务过程事实和时间间隔事实    |
| 事实表加载 |          插入          |               插入               |              插入与更新              |
| 事实表更新 |         不更新         |              不更新              |          业务过程变更时更新          |

---

### 维度整合 & 维度拆分

**维度整合：**

数据仓库的重要数据来源是大量的、分散的面向应用的操作型环境。所以数据由操作型环境进入数据仓库后，需要进行数据集成。具体体现在如下几个方面：

- 命名规范的统一。表名、字段名等统一。
- 字段类型的统一。相同和相似字段的字段类型统一。
- 公共代码及代码值的统一。公共代码及标志性字段的数据类型、命名方式等统一。
- 业务含义相同的表的统一。将业务关系大、差异小的表进行整合。

将维度相关的维度属性做到统一。来源系统多的情况下，表名、字段名要统一。

案例 1：如 A 系统用户 ID 是 userid，B 系统是 user_id，维度表需要将这些统一；

案例 2：公共代码和编码值统一，如 A 系统男 1，女 0，B 系统男 M，女 F。

**维度拆分：**

当一张维度表中包含多个类别、加工逻辑十分困难、有部分维度属性可以单独处理或者不常用时，考虑将维度拆分。

- 水平拆分：单独一张维度表无法很好适配事实表，如普通商品和航旅商品，都有价格、类型、上架时间等公共属性，但航旅商品还有自己独特的维度属性，如酒店、景点、门票等。可以建一张单独的航旅商品维表进行维护
- 垂直拆分：维度表的一些维度属性有明显的热度、使用频率的区别，如可以将热度低、使用频率低的属性单独拆分出去。

---

### 如何处理缓慢变化维度

- 保留或重写（适用于不需要考虑历史变化的维度，优点是简化 ETL，节省存储空间）
- 增加新行（维度变化时增加新行，并通过生效时间和失效时间来标识数据，维度值变化前的事实和过去的维度值关联，维度值变化后的事实和当前的维度值关联）
- 增加新列（增加新列，维护修改之前的维度值和修改之后的维度值，适合变化频率很低的维度属性）
- 快照存储（每次更新维护一个全量的历史快照表，会占用大量的存储空间）
- 拉链表存储（通过维护生效时间和失效时间来标识新数据还是旧数据）

---

### 数仓建模的基本流程

1. 沟通业务需求、技术需求
2. 逻辑设计，细化需求中的数据、理清数据之间的关系
3. 物理设计，建表、合理设置分区
4. 数据处理，数据抽取、转化、加载
5. 数据应用构建与数据使用
6. 数据维护
7. 数据质量保障和维护

---

### 在数据处理的各个阶段，使用过哪些工具

- 数据存储：MySQL、HDFS、HBase
- 数据同步：DataX
- 数据抽取：Kafka、Flume
- 数据清洗、处理：Hive、Spark
- 任务调度：Airflow、DolphinScheduler

---

### 数据质量包括哪些方面

1. **完整性**：是指数据的记录和信息是否完整，是否存在缺失的情况。
2. **准确性**：是指数据中记录的信息和数据是否准确，是否存在异常或者错误的信息。
3. **一致性**：一般体现在跨度很大的数据仓库体系中，比如阿里巴巴数据仓库，内部有很多业务数据仓库分支，对于同一份数据，必须保证一致性。
4. **及时性**：指的是保障数据能够及时产出。

---

### DQC

DQC：Data Quality Check，数据质量检查，用于在数据处理的过程中检查数据质量，可以通过设定规则对数据处理过程中的数据进行监控和告警。常用于检查主键是否唯一，检查空值，数据类型和精度等。

核心作用：对核心的维度、指标数据进行监控。例如主键是否唯一，量级是否符合预期，维度等是否做了非空处理，指标字段数据类型精度等是否有问题。

---

### SLA

SLA：Service Level Agreement，在数仓场景中通常指最晚出数时间，SLA 可以通过上游任务的历史执行时间推测一个预计的执行时间，以此来预估一个任务的最晚的产出时间。主要注重数据服务的时效性和稳定性。

---

### 什么是总线矩阵

总线矩阵：是**对业务过程、一致性维度的划分**，主要呈现的是两者之间的关系。

构建总线矩阵：核心需要做两件事情：

1. 明确每个数据域下有哪些业务过程。
2. 业务过程与哪些维度相关，并通过总线矩阵定义每个数据域下的业务过程和维度。

![](https://raw.githubusercontent.com/MXJULY/image/main/img/202401201946858.png)

---

### 为什么要做数仓分层

1. **清晰数据结构**：每一个数据分层都有**对应的作用域**，在使用数据的时候能更方便的定位和理解。

2. **数据血缘追踪**：提供给业务人员或下游系统的数据服务时都是目标数据，目标数据的数据来源一般都来自于多张表数据。若出现目标数据异常时，**清晰的血缘关系可以快速定位问题所在**。而且，血缘管理也是元数据管理重要的一部分。

3. **减少重复开发**：数据的逐层加工原则，下层包含了上层数据加工所需要的全量数据，这样的加工方式避免了每个数据开发人员都重新从源系统抽取数据进行加工。

4. **数据关系条理化**：源系统间存在复杂的数据关系，数据仓库会对相同主题的数据进行统一建模，**把复杂的数据关系梳理成条理清晰的数据模型**。

5. **屏蔽原始数据的影响**：数据的逐层加工原则，上层的数据都由下一层的数据加工获取，不允许跳级取数。而原始数据位于数仓的最底层，离应用层数据还有多层的数据加工，所以加工应用层数据的过程中就会**把原始数据的变更消除掉，保持应用层的稳定性**。

---

### 介绍 ods 层、dwd 层、dws 层、ads 层

- 数据接入层（ODS）：存放原始数据，结构上与源系统基本保持一致。
- 明细层（DWD）：以业务过程作为建模驱动，构建最细粒度的明细事实表。
- 汇总层（DWS）：以分析的主题作为建模驱动，构建公共粒度的汇总指标表。
- 数据应用层（ADS）：存放数据产品个性化的统计指标数据。

以交易主题数据域为例：

ODS 层存放订单项表，订单表等
DWD 层存放订单项明细事实表、订单信息明细事实表等
DWS 层存放商品统计汇总表、用户行为汇总表、地区汇总表等
ADS 层存放订单汇总统计表、各地区订单统计表等

---

### 介绍一下数仓主题的划分原则

1. 按照业务过程来划分，对业务过程进行一个抽象，从而得到主题域。
2. 按照数据域来划分，比如把商品、用户作为分析对象，那相应的主题域就是商品主题域、用户主题域。

---

### 数据模型设计过程中需要遵循哪些基本原则

1. 高内聚，低耦合
2. 核心模型与扩展要分离
3. 公共处理低层封装
4. 适当的数据冗余可以使成本性能相平衡
5. 数据可回滚
6. 命名规范，清晰且一致

---

### 请举例说说数仓层次调用的过程中需要遵循哪些基本的规范

总体遵循的层次调用原则如下：

- ODS 层数据不能直接被应用层任务引用。如果中间层没有沉淀的 ODS 层数据，则通过 CDM 层的视图访问。CDM 层视图必须使用调度程序进行封装，保持视图的可维护性与可管理性。
- CDM 层任务的深度不宜过大（建议不超过 10 层）。
- 一个计算刷新任务只允许一个输出表，特殊情况除外。
- CDM 汇总层优先调用 CDM 明细层，可累加指标计算。CDM 汇总层尽量优先调用已经产出的粗粒度汇总层，避免大量汇总层数据直接从海量的明细数据层中计算得出。
- CDM 明细层累计快照事实表优先调用 CDM 事务型事实表，保持数据的一致性产出。
- 有针对性地建设 CDM 公共汇总层，避免应用层过度引用和依赖 CDM 层明细数据。

---

## 项目类

### 请介绍一下电商中常见的用户指标、流量指标、搜索指标、商品指标、订单交易指标

**用户指标：**

- 注册用户数：注册电商平台用户数；
- 活跃用户数：登录 APP 用户数；
- 浏览商详用户数：浏览商品详情页用户数；
- 新用户数：历史成交订单数为 0 的用户数；
- 老用户数：历史成交订单数大于 0 的用户数；
- 复购用户数：历史成交订单数大于 1 的用户数；
- 沉默用户数：距离上次登录 APP 大于 30 天，小于 90 天的用户数；
- 流失用户数：距离上次登录 APP 大于等于 90 天的用户数。

---

**流量指标：**

- 页面曝光 UV；
- 页面曝光 PV；
- 页面点击 UV；
- 页面点击 PV；
- 页面 UV 点击率=页面点击 UV/页面曝光 UV；
- 页面 PV 点击率=页面点击 PV/页面曝光 PV；
- 人均曝光=页面曝光 PV/页面曝光 UV；
- 人均点击=页面点击 PV/页面点击 UV。

---

**搜索指标：**

- 搜索曝光 UV；
- 搜索曝光 PV；
- 搜索点击 PV；
- 搜索点击 PV；
- 搜索 UV 使用率=搜索点击 UV/搜索曝光 UV；
- 搜索 PV 使用率=搜索点击 PV/搜索曝光 PV；
- 人均搜索次数=搜索点击 PV/搜索点击 UV；
- 人均搜索词量=（搜索有结果词量+搜索无结果词量）/搜索点击 UV。

---

**商品指标：**

- 商品数量；
- 商品上新数量；
- 商品有库存数量；
- 商品无库存数量；
- 商品有销售数量；
- 商品无销售数量；
- 商品上新率=商品上新数量 /商品数量；
- 商品动销率=商品有销售数量 /商品数量；
- 商品滞销率=商品无销售数量 /商品数量；
- 商品倾销率=商品无库存数量 /商品数量。

---

**订单交易指标：**

- 下单数量；
- 下单人数；
- 下单金额。
- 成交数量；
- 成交人数；
- 成交金额；
- 成交件单价=成交金额/成交数量；
- 成交客单价=成交金额/成交人数；
- 成交人数转化率=成交人数/下单人数；
- 成交订单转化率=成交数量/下单数量。

---

### 请简要描述一下什么是用户画像？用户画像通常包括哪些数据？

**用户画像就是人的数据标签**。这些标签是基于用户的日常行为信息、兴趣爱好、交易数据以及社会属性计算出来的模型，**多个标签的组合**就形成了用户画像。

用户画像包括 3 类数据：

- 用户基本数据：包含性别、年龄、职业和职业地域等数据。
- 电商行为数据：包含搜索、访问时长、加购、活跃度等行为数据。
- 电商交易数据：包含客单价、用户的下单量、下单金额、下单频次等交易数据。

---

### 请简述一下用户下订单路径，并且说明一下在各个环节涉及到哪些数据

流程：主页 → 搜索/点击 → 加购/购买 → 结算 → 支付

- 主页：页面 PV、页面 UV
- 搜索、点击：用户行为数据，商品数据
- 加购、购买：用户行为数据、订单数据、商品数据
- 结算、支付：营销数据、交易数据

---

### 请讲一下电商业务架构的核心模块、并简述一下电商业务系统的核心流程

- 核心模块：电商业务包括三个主要实体，即供应商、电商平台、消费者。

- 核心流程：一件商品卖给消费者需要经历的环节非常多，进行抽象后，可以将自营电商业务划分为以下 4 个核心部分，分别是：从供应商处采购产品，采购产品入仓存储管理，商品上架到电商平台销售，根据销售订单进行履约配送。

---

### 请说一下你在做交易数据过程中核心用到的数据表有哪些？

- ODS 层：订单项信息表、订单表、商品表
- DWD 层：订单项明细事实表、订单信息明细事实表、订单退款明细事实表
- DWS 层：商品统计汇总表、用户交易行为汇总表、用户交易地区汇总表
- ADS 层：不同时间段内的订单汇总统计表、不同时间段各地区订单统计表

---

### 介绍一下项目的业务背景和技术背景，项目中核心的业务过程、项目整体架构，并对每个主题域的数据建设做简要说明

业务背景：建设维护电商数仓，为管理层提供运营数据、支持管理决策；为运营、数据分析师提供数据支持、建设可视化看板；为商户提供运营数据支持。

技术背景：通过建设维护数据仓库，为业务方、产品、数据分析师等提供数据支持，建设可视化看板，为管理层支持管理决策。

核心业务过程与项目架构：电商业务的包括三个核心模块：供应商、电商平台、消费者，业务核心流程包括从供应商处采购商品、采购商品入库管理、商品上架平台、平台销售商品、订单履约配送。

主题域建设：

- 用户主题域：根据增长业务团队的需求，需要满足业务团队在不同场景、不同维度的用数需求，主要是 DWS、ADS 层的建设
- 商品主题域：为了保证公司层面的数据一致性和准确性，需要对不同商品系统的数据进行整合
- 交易主题域：需要将下单、支付、退款等流程的数据整合，形成完整的数据体系，并支持跨数据域的数据探查需求
- 营销数据域：需要对优惠券等营销数据进行建设，满足业务方的用数需求

---

### 请结合用户或者交易主题域的数据建设情况，阐述一下维度建模的具体流程

以交易域为例，核心业务过程是下单 → 支付 → 退款

- 需求收集：交易和支付业务团队需要关注订单的转化率、订单支付状态等数据
- 选择业务过程：用户下单 → 支付 → 收货/退款
- 声明粒度：粒度为每笔子订单
- 确定维度：用户、商品、地区
- 确定事实：订单金额、订单数量、商品数量等

---

### 请结合商品主题域的数据建设情况，阐述一下你对维表建设的思路

核心思路是：**选择维度 → 确认主维表 → 确认相关维表 → 确认维度表字段**。

以商品维度举例：

- 选择维度：商品维度
- 确定主维表：商品表
- 确定相关维表：商品分类表、商品品牌表、SPU 表等
- 确定维度属性：商品表中的商品 ID、商品名称、商品价格等；商品分类表中的商品分类 ID、商品分类名称等；商品品牌表中的商品品牌 ID、商品品牌名称等；SPU 表中的商品 SPU ID、商品 SPU 名称等。这些表通过对应的主外键关联，可以得到一张维度属性丰富的宽表。

---

### 请以交易主题域的数据建设为例，讲一下数仓分层是怎么做的，每一层分别有哪些数据表和字段

交易域的核心业务过程是：下单 → 支付 → 退款

- ODS：直接从业务系统同步，包括订单项信息表、订单表、商品表
- DWD：根据业务过程，构建细粒度的明细事实表，包括订单项明细事实表、订单信息明细事实表、订单退款明细事实表
- DWS：根据分析的主题对象，基于指标需求，构建公共粒度的汇总指标表，包括商品统计汇总表、用户交易行为汇总表、用户交易地区汇总表
- ADS：存放个性的统计指标数据，包括不同时间段内的订单汇总统计表、不同时间段的各地区订单统计表
